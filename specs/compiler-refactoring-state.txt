Compiler Refactoring State
===========================

Last completed: Phase 2.3 - gen_push/gen_pop/gen_move_typed in codegen.c
  Branch: phase2.3-typed-moves (merged to master)

Phase 1 (all 6 steps) - merged to master
  1.1: Consolidated frame_ptr[] from 11 static copies to one in misc.c + extern in acedef.h
  1.2: Extracted make_ext_name() in misc.c, replaced 6 occurrences
  1.3: Extracted make_modvar_bss_name() in misc.c, replaced 4 occurrences
  1.4: Extracted alloc_die() static helper in sym.c, replaced 18 blocks
  1.5: Extracted sym_to_type() in misc.c, replaced 9 switch blocks
  1.6: Changed structmem_exist() to return STRUCM*, replaced 2 manual loops

Phase 2 (codegen layer)
  2.1: Created codegen.c with gen_rt_call(funcname) - wraps gen("jsr",...)+enter_XREF()
       - New file: src/ace/c/codegen.c
       - Prototype in acedef.h, added to Makefile-ace SOURCES
       - Replaced ~235 jsr+enter_XREF pairs across 20 source files
       - Files modified: declare.c, memory.c, misc.c, iff.c, window.c, screen.c,
         serial.c, menu.c, libfunc.c, message.c, event.c, gadget.c, print.c,
         gfx.c, assign.c, file.c, expr.c, factor.c, statement.c, basfun.c
       - LVO calls through (a6), indirect (a0), and dynamic name calls excluded
  2.2: Extracted gen_frame_addr(address, buf) into codegen.c
       - Wraps itoa(-1*address, buf, 10) + strcat(buf, frame_ptr[lev])
       - Added extern int lev to codegen.c, prototype in acedef.h
       - Replaced ~46 occurrences across 12 source files
       - Files modified: assign.c, statement.c, factor.c, sub.c, file.c,
         declare.c, misc.c, basfun.c, control.c, gfx.c, serial.c, message.c
       - Excluded: sub.c parse_shared_vars() hardcoded (a4)/(a5) for cross-level sharing

  2.3: Extracted gen_push/gen_pop/gen_move_typed into codegen.c
       - gen_push(type, src): move.w/l src, -(sp) based on shorttype
       - gen_pop(type, dest): move.w/l (sp)+, dest based on shorttype
       - gen_move_typed(type, src, dest): move.w/l src, dest based on shorttype
       - Replaced ~37 occurrences across 8 source files
       - Files modified: expr.c, factor.c, sub.c, assign.c, control.c,
         declare.c, statement.c, misc.c
       - Excluded: change_Flt (uses change()), extvar push (3-way with pea),
         FOR default step (singletype uses different value), FOR step add
         (move+add coupled), print.c/file.c (pop+type-specific call per case),
         assign extvar (3-way with string lea+strcpy), INVOKE closure
         bound-arg read (always move.l), INVOKE closure param copy with
         bound-arg truncation (extra truncation code)

Test suite: 51/51 pass (syntax 12, arithmetic 9, floats 10, control 10, errors 10)

Next step: Phase 2.4 or new phase TBD
